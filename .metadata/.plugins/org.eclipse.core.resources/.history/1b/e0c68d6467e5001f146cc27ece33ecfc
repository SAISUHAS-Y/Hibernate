package com.jsp.hibernate_actor_movie.dao;

import java.util.Iterator;
import java.util.List;
import java.util.Scanner;
import javax.persistence.Query;
import javax.persistence.criteria.CriteriaBuilder;
import javax.persistence.criteria.CriteriaQuery;
import javax.persistence.criteria.CriteriaUpdate;
import javax.persistence.criteria.Root;
import javax.persistence.EntityManager;
import javax.persistence.EntityManagerFactory;
import javax.persistence.EntityTransaction;
import javax.persistence.Persistence;



import com.jsp.hibernate_actor_movie.entity.Actor;
import com.jsp.hibernate_actor_movie.entity.Movie;

public class ActorDao {
	
	EntityManagerFactory emf=null;
	Scanner sc=new Scanner(System.in);
	
	public void addActor() {
		Actor actor=new Actor();
		System.out.println("Enter the actorId:");
		actor.setActorId(sc.nextInt());
		System.out.println("Enter the ActorName");
		actor.setActorName(sc.next());
		System.out.println("Enter the actorAge");
		actor.setActorAge(sc.nextInt());
		System.out.println("Enter the actorSalary");
		actor.setActorSalary(sc.nextInt());
		System.out.println("Enter the actorIndustry");
		actor.setActorIndustry(sc.next());
		System.out.println("Enter the actorNationality");
		actor.setActorNation(sc.next());
		
		emf=Persistence.createEntityManagerFactory("mysql-config");
		EntityManager em=emf.createEntityManager();
		EntityTransaction et=em.getTransaction();
		et.begin();
		em.persist(actor);
		et.commit();
		em.close();
		if(emf!=null) {
			emf.close();
		}
	}
	
	public void findActorById() {
		emf=Persistence.createEntityManagerFactory("mysql-config");
		EntityManager em=emf.createEntityManager();
		EntityTransaction et=em.getTransaction();
		et.begin();
		
		System.out.println("Enter the actorId to find :---");
		Actor a=em.find(Actor.class, sc.nextInt());
		if(a!=null) {
			System.out.println(a);
		}
		else {
			System.out.println("Not found ");
		}
		et.commit();
		em.close();
		if(emf!=null) {
			emf.close();
		}

	}
	
	public void findAllActorByName() {
		emf=Persistence.createEntityManagerFactory("mysql-config");
		EntityManager em=emf.createEntityManager();
		EntityTransaction et=em.getTransaction();
		et.begin();
		System.out.println("Enter the Actor name");
		Query query=em.createQuery("Select a.actorName from Actor a where a.actorName=:name",Actor.class);
		query.setParameter("name", sc.next());
		List<Actor> actors=query.getResultList();
		for (Actor actor : actors) {
			System.out.println(actor);
		}
		
		et.commit();
		em.close();
		if(emf!=null) {
			emf.close();
		}

	}
	
	public void findAllActorByIndustry() {
		emf=Persistence.createEntityManagerFactory("mysql-config");
		EntityManager em=emf.createEntityManager();
		EntityTransaction et=em.getTransaction();
		et.begin();
		
		CriteriaBuilder builder=em.getCriteriaBuilder();
		
		
		CriteriaQuery<Actor> query=builder.createQuery(Actor.class);
		Root<Actor>root=query.from(Actor.class);
		
		System.out.println("Enter the Industry name to find:-");
		query.where(builder.equal(root.get("actorIndustry"), sc.next()));
		
		Query query2=em.createQuery(query);
		List<Actor> list=query2.getResultList();
		for (Actor actor : list) {
			System.out.println(actor);
		}

		et.commit();
		em.close();
		if(emf!=null) {
			emf.close();
		}
	}
	
	public void findAllActorsBetweenAge() {
		emf=Persistence.createEntityManagerFactory("mysql-config");
		EntityManager em=emf.createEntityManager();
		EntityTransaction et=em.getTransaction();
		et.begin();
		System.out.println("Enter the Actor age");
		int a=sc.nextInt();
		System.out.println("Enter the second age to between");
		int b=sc.nextInt();
		Query query=em.createQuery("Select a from Actor a where a.actorage between a and b ",Actor.class);
		List<Actor> actors=query.getResultList();
		for (Actor actor : actors) {
			System.out.println(actor);
		}
		
		et.commit();
		em.close();
		if(emf!=null) {
			emf.close();
		}

	}
	
	public void findActorByMovieId() {
		emf=Persistence.createEntityManagerFactory("mysql-config");
		EntityManager em=emf.createEntityManager();
		EntityTransaction et=em.getTransaction();
		et.begin();
		
		System.out.println("Enter the movie Id to find Actor");
		int a=sc.nextInt();
		Query query=em.createQuery("select m from Movie m where m.movieId=:id ",Movie.class);
		query.setParameter("id", a);
			List<Movie> movie=query.getResultList();
			for (Movie movie2 : movie) {
				System.out.println(movie2.getActors());
			}
		et.commit();
		em.close();
		if(emf!=null) {
			emf.close();
		}
		
	}
	
	public void updateAllActorSalaryByMovieTitle() {
		emf=Persistence.createEntityManagerFactory("mysql-config");
		EntityManager em=emf.createEntityManager();
		EntityTransaction et=em.getTransaction();
		et.begin();
		
		CriteriaBuilder builder=em.getCriteriaBuilder();
		
		
		CriteriaQuery<Movie> query=builder.createQuery(Movie.class);
		Root<Movie>root=query.from(Movie.class);
		
		System.out.println("Enter the Movie Title to find Actor details ");
		CriteriaQuery<Movie> m=query.where(builder.equal(root.get("movieTitle"), sc.nextLine()));
		
		Query query2=em.createQuery(query);
		List<Movie> movieList=query2.getResultList();
		if(movieList!=null) {
			for (Movie movie : movieList) {
				System.out.println("found Succesfull them below");
				System.out.println("Enter the salary to update");
				Actor a =new Actor();
				CriteriaUpdate<Actor> query1=builder.createCriteriaUpdate(Actor.class);
				Root<Actor>root1=query1.from(Actor.class);
				int salary=a.getActorSalary()+sc.nextInt();
				query1.set(root1.get("actorsalary"), salary);
				query1.where(builder.equal(root.get("movieTitle"), m));
				
				
			}
		}
		else {
			System.err.println("Not found by movie title");
		}
		

		et.commit();
		em.close();
		if(emf!=null) {
			emf.close();
		}
		
	}
	
	public void deleteAllActorWithSalaryGreaterThan() {
		emf=Persistence.createEntityManagerFactory("mysql-config");
		EntityManager em=emf.createEntityManager();
		EntityTransaction et=em.getTransaction();
		et.begin();
		
		CriteriaBuilder builder=em.getCriteriaBuilder();
		
		
		CriteriaQuery<Actor> query=builder.createQuery(Actor.class);
		Root<Actor>root=query.from(Actor.class);
		
		System.out.println("Enter the salary to find greatest name to find:-");
		query.where(builder.gt(root.get("actorSalary"), sc.nextInt()));
		
		Query query2=em.createQuery(query);
		List<Actor> list=query2.getResultList();
		for (Actor actor : list) {
			System.out.println(actor);
		}

		et.commit();
		em.close();
		if(emf!=null) {
			emf.close();
		}
	}
	
	public void deleteAllActorByMovieGenre() {
		emf=Persistence.createEntityManagerFactory("mysql-config");
		EntityManager em=emf.createEntityManager();
		EntityTransaction et=em.getTransaction();
		et.begin();
		
		System.out.println("Enter the movie Genre to delete Actor detials");
		Query query=em.createQuery("select m from Movie m where m.movieGenre=:ge ",Movie.class);
		query.setParameter("ge", sc.nextLine());
			List<Movie> movieList=query.getResultList();
			if(movieList!=null) {
				for (Movie movie : movieList) {
					List<Actor> actor=movie.getActors();
					Query query1=em.createQuery("delete from Actor a where a.actors=:id");
					query1.setParameter("id", actor);
					
				}
			}
			else {
				System.err.println("Genure not found");
			}
			
		et.commit();
		em.close();
		if(emf!=null) {
			emf.close();
		}
		
	}

}
