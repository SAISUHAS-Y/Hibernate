package com.jsp.hibernate_actor_movie.dao;

import java.util.List;
import java.util.Scanner;
import javax.persistence.Query;
import javax.persistence.criteria.CriteriaBuilder;
import javax.persistence.criteria.CriteriaQuery;
import javax.persistence.criteria.Root;
import javax.persistence.EntityManager;
import javax.persistence.EntityManagerFactory;
import javax.persistence.EntityTransaction;
import javax.persistence.Persistence;



import com.jsp.hibernate_actor_movie.entity.Actor;
import com.jsp.hibernate_actor_movie.entity.Movie;

public class ActorDao {
	
	EntityManagerFactory emf=null;
	Scanner sc=new Scanner(System.in);
	
	public void addActor() {
		Actor actor=new Actor();
		System.out.println("Enter the actorId:");
		actor.setActorId(sc.nextInt());
		System.out.println("Enter the ActorName");
		actor.setActorName(sc.next());
		System.out.println("Enter the actorAge");
		actor.setActorAge(sc.nextInt());
		System.out.println("Enter the actorSalary");
		actor.setActorSalary(sc.nextInt());
		System.out.println("Enter the actorIndustry");
		actor.setActorIndustry(sc.next());
		System.out.println("Enter the actorNationality");
		actor.setActorNation(sc.next());
		
		emf=Persistence.createEntityManagerFactory("mysql-config");
		EntityManager em=emf.createEntityManager();
		EntityTransaction et=em.getTransaction();
		et.begin();
		em.persist(actor);
		et.commit();
		em.close();
		if(emf!=null) {
			emf.close();
		}
	}
	
	public void findActorById() {
		emf=Persistence.createEntityManagerFactory("mysql-config");
		EntityManager em=emf.createEntityManager();
		EntityTransaction et=em.getTransaction();
		et.begin();
		
		System.out.println("Enter the actorId to find :---");
		Actor a=em.find(Actor.class, sc.nextInt());
		if(a!=null) {
			System.out.println(a);
		}
		else {
			System.out.println("Not found ");
		}
		et.commit();
		em.close();
		if(emf!=null) {
			emf.close();
		}

	}
	
	public void findAllActorByName() {
		emf=Persistence.createEntityManagerFactory("mysql-config");
		EntityManager em=emf.createEntityManager();
		EntityTransaction et=em.getTransaction();
		et.begin();
		System.out.println("Enter the Actor name");
		Query query=em.createQuery("Select a.actorName from Actor a where a.actorName=:name",Actor.class);
		query.setParameter("name", sc.next());
		List<Actor> actors=query.getResultList();
		for (Actor actor : actors) {
			System.out.println(actor);
		}
		
		et.commit();
		em.close();
		if(emf!=null) {
			emf.close();
		}

	}
	
	public void findAllActorByIndustry() {
		emf=Persistence.createEntityManagerFactory("mysql-config");
		EntityManager em=emf.createEntityManager();
		EntityTransaction et=em.getTransaction();
		et.begin();
		
		CriteriaBuilder builder=em.getCriteriaBuilder();
		
		
		CriteriaQuery<Actor> query=builder.createQuery(Actor.class);
		Root<Actor>root=query.from(Actor.class);
		
		System.out.println("Enter the Industry name to find:-");
		query.where(builder.equal(root.get("actorIndustry"), sc.next()));
		
		Query query2=em.createQuery(query);
		List<Actor> list=query2.getResultList();
		for (Actor actor : list) {
			System.out.println(actor);
		}

		et.commit();
		em.close();
		if(emf!=null) {
			emf.close();
		}
	}
	
	public void findAllActorsBetweenAge() {
		emf=Persistence.createEntityManagerFactory("mysql-config");
		EntityManager em=emf.createEntityManager();
		EntityTransaction et=em.getTransaction();
		et.begin();
		System.out.println("Enter the Actor age");
		int a=sc.nextInt();
		System.out.println("Enter the second age to between");
		int b=sc.nextInt();
		Query query=em.createQuery("Select a from Actor a where a.actorage between a and b ",Actor.class);
		List<Actor> actors=query.getResultList();
		for (Actor actor : actors) {
			System.out.println(actor);
		}
		
		et.commit();
		em.close();
		if(emf!=null) {
			emf.close();
		}

	}
	
	public void findActorByMovieId() {
		emf=Persistence.createEntityManagerFactory("mysql-config");
		EntityManager em=emf.createEntityManager();
		EntityTransaction et=em.getTransaction();
		et.begin();
		Movie m=new Movie();
		Query query=em.createQuery("select m from Movie m ",Movie.class);
		List<Actor> actor=m.getActors();
		for (Actor actor2 : actor) {
			System.out.println(actor2);
		}
		et.commit();
		em.close();
		if(emf!=null) {
			emf.close();
		}
		
	}
	
	public void updateAllActorByMovieTitle() {
		
	}
	
	public void deleteAllActorWithSalaryGreaterThan() {
		emf=Persistence.createEntityManagerFactory("mysql-config");
		EntityManager em=emf.createEntityManager();
		EntityTransaction et=em.getTransaction();
		et.begin();
		
		CriteriaBuilder builder=em.getCriteriaBuilder();
		
		
		CriteriaQuery<Actor> query=builder.createQuery(Actor.class);
		Root<Actor>root=query.from(Actor.class);
		
		System.out.println("Enter the salary to find greatest name to find:-");
		query.where(builder.gt(root.get("actorSalary"), sc.nextInt()));
		
		Query query2=em.createQuery(query);
		List<Actor> list=query2.getResultList();
		for (Actor actor : list) {
			System.out.println(actor);
		}

		et.commit();
		em.close();
		if(emf!=null) {
			emf.close();
		}
	}
	
	public void deleteAllActorByMovieGenre() {
		
	}

}
